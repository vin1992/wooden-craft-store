@using System.ComponentModel.DataAnnotations
@rendermode InteractiveServer

<div class="image-picker">
    <RadzenCarousel @bind-SelectedIndex="@currentIndex"
                    AllowNavigation="false"
                    AllowPaging="false"
                    Auto="false">
        <Items>
            @foreach (var imageUrl in Images)
            {
                <RadzenCarouselItem @key="imageUrl">
                    <div class="image-container">
                        <img src="@imageUrl" />
                    </div>
                </RadzenCarouselItem>
            }
        </Items>
    </RadzenCarousel>

    <div class="thumbnails">
        @for (int i = 0; i < Images.Count; i++)
        {
            // 捕获循环变量
            var imageIndex = i;
            var currentImageUrl = Images[i];

            <div class="thumb-item" @key="currentImageUrl" @onclick="() => SetCurrentIndex(imageIndex)">
                <img src="@currentImageUrl" class="thumb @(i == currentIndex ? "active-thumb" : "")" />
            </div>
        }
    </div>
</div>

@code {
    private int currentIndex = 0;

    [Parameter]
    [Required]
    public List<string> Images { get; set; } = new();

    private void SetCurrentIndex(int index)
    {
        if (index >= 0 && index < Images.Count)
        {
            currentIndex = index;
        }
    }

    protected override void OnParametersSet()
    {
        if (currentIndex >= Images.Count && Images.Count > 0)
        {
            currentIndex = Images.Count - 1;
        }
        else if (Images.Count == 0)
        {
             currentIndex = 0;
        }
    }
}